trigger:
  branches:
    include:
      - master
      - next
      - release/*
  paths:
    include:
      - src/*

pool:
  name: Lab
  demands:
    - Agent.OS -equals Linux

resources:
  repositories:
    - repository: template
      name: DevOps/Template
      type: git


variables:
  - name: ReleaseTag
    ${{ if eq(variables['Build.SourceBranchName'], 'master') }}:
      value: latest
    ${{ elseif eq(variables['Build.SourceBranchName'], 'next') }}:
      value: alpha
    ${{ elseif contains(variables['Build.SourceBranch'], 'release') }}:
      value: beta
    ${{ else }}:
      value: insiders

stages:
  - stage: CI
    jobs:
      - template: lab/ngxtw/demo/job.build.yml@template

  - stage: CD
    dependsOn: CI
    pool:
      name: Lab
      demands:
        - Agent.OS -equals Linux
        - AZP_RUNS -equals demo
    jobs:
      - template: lab/ngxtw/demo/job.release.yml@template
